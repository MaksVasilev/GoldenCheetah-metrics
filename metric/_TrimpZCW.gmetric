<usermetrics version="1">
	<usermetric symbol="_TrimpZCW" name="_TrimpZCW" description="TRIMP с весовыми центровзвешенными коэффициентами по зонам." unitsMetric="TRIMP баллы" unitsImperial="TRIMP баллы" aggzero="1" istime="0" precision="2" type="0" conversion="1" conversionSum="0" fingerprint="_TrimpZCW{value{dHR&lt;-(Average_Heart_Rate-config(rhr))/(config(maxhr)-config(rhr));b1&lt;-1.92;b2&lt;-0.64;kz1&lt;-0.595;kz2&lt;-0.777;kz3&lt;-0.979;kz4&lt;-1.201;kz5&lt;-1.447;if(Sport=&quot;Run&quot;||Sport=&quot;Treadmill&quot;){kz1&lt;-0.459;kz2&lt;-0.696;kz3&lt;-0.964;kz4&lt;-1.268;kz5&lt;-1.612;}if(Sport=&quot;Swim&quot;){kz1&lt;-0.432;kz2&lt;-0.680;kz3&lt;-0.962;kz4&lt;-1.282;kz5&lt;-1.644;}if(Sport=&quot;Ski&quot;){kz1&lt;-0.387;kz2&lt;-0.656;kz3&lt;-0.959;kz4&lt;-1.304;kz5&lt;-1.694;}if(Sport=&quot;Ice&quot;){kz1&lt;-0.234;kz2&lt;-0.560;kz3&lt;-0.938;kz4&lt;-1.378;kz5&lt;-1.889;}if(Time_Recording&gt;0){time&lt;-Time_Recording;}elseif(Time_Moving&gt;0){time&lt;-Time_Moving;}else{time&lt;-Duration;}base&lt;-((time/60)*dHR*b2*exp(b1*dHR))/(100.0);trimp_zcw&lt;-(base*H1_Percent_in_Zone*kz1)+(base*H2_Percent_in_Zone*kz2)+(base*H3_Percent_in_Zone*kz3)+(base*H4_Percent_in_Zone*kz4)+(base*H5_Percent_in_Zone*kz5);if((Max_Heartrate)=0){trimp_zcw&lt;-base*100.0;}if(trimp_zcw&lt;0){trimp_zcw&lt;-0;}trimp_zcw;}}" >
{ \n  value {\n    # резерв ЧСС\n    dHR &lt;- (Average_Heart_Rate-config(rhr))/(config(maxhr)-config(rhr));\n\n    # коэффициент лактата\n    b1 &lt;- 1.92; b2 &lt;- 0.64; # for Man or b1&lt;-1.67; b2&lt;-0.86 for Woman\n\n    # весовые коэффициенты зон\n    # велосипед, велотренажёр и по умолчанию\n    kz1 &lt;- 0.595; kz2 &lt;- 0.777; kz3 &lt;- 0.979; kz4 &lt;- 1.201; kz5 &lt;- 1.447;\n\n    if (Sport = &quot;Run&quot; || Sport = &quot;Treadmill&quot;)\n      { kz1 &lt;- 0.459; kz2 &lt;- 0.696; kz3 &lt;- 0.964; kz4 &lt;- 1.268; kz5 &lt;- 1.612; }\n    if (Sport = &quot;Swim&quot;)\n      { kz1 &lt;- 0.432; kz2 &lt;- 0.680; kz3 &lt;- 0.962; kz4 &lt;- 1.282; kz5 &lt;- 1.644; }\n    if (Sport = &quot;Ski&quot; )\n      { kz1 &lt;- 0.387; kz2 &lt;- 0.656; kz3 &lt;- 0.959; kz4 &lt;- 1.304; kz5 &lt;- 1.694; }\n    if (Sport = &quot;Ice&quot;)\n      { kz1 &lt;- 0.234; kz2 &lt;- 0.560; kz3 &lt;- 0.938; kz4 &lt;- 1.378; kz5 &lt;- 1.889; }\n\n    # если тренировка введена вручную, то у неё может не быть времени записи и/или движения\n    if (Time_Recording &gt; 0) { time &lt;- Time_Recording; }\n    else if ( Time_Moving &gt; 0 ) { time &lt;- Time_Moving; }\n    else { time &lt;- Duration; }\n\n    # база TRIMP\n    base &lt;- (( time /60) * dHR * b2 * exp(b1*dHR))/(100.0);\n\n    # сумма частей TRIMP по зонам\n    trimp_zcw &lt;- (base * H1_Percent_in_Zone * kz1) + (base * H2_Percent_in_Zone * kz2) + (base * H3_Percent_in_Zone * kz3) + (base *  H4_Percent_in_Zone * kz4) + (base * H5_Percent_in_Zone * kz5);\n\n    # если тренировка введена вручную и не содержит данных по пульсу,\n    # а только продолжительность и средний пульс, возвращаем классический TRIMP\n    if ( (Max_Heartrate) = 0) { trimp_zcw &lt;- base * 100.0; } \n\n    # ошибки вычисления на тренировках без записи ЧСС и без ручной записи среднего ЧСС\n    if (trimp_zcw &lt; 0) { trimp_zcw &lt;- 0; }\n\n    trimp_zcw;\n  }\n}\n\n#
</usermetric>
</usermetrics>
